/*!
 * Previewer v0.0.1
 * https://github.com/fengyuanchen/previewer
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b=window.location,c=function(b,c){var d;this.$element=a(b),d=this.$element.attr("previewer"),this.open="undefined"!=typeof d,this.device=c||d||"phone",this.init()};c.prototype={construstor:c,init:function(){var a;window.parent!==window.self&&window.parent.previewerInitialized||(window.previewerInitialized=!0,a=b.search.match(/previewer\=?(phone|tablet|laptop|desktop)?/i),a&&(this.open=!0,this.device=a[1]||this.device),this.open&&this.enable())},enable:function(){this.active||(this.$previewer=a(c.template),this.$viewport=this.$previewer.find(".previewer-viewport"),this.$element.addClass("previewer-open").prepend(this.$previewer),this.$previewer.addClass("previewer-"+this.device),this.addListener(),this.redirect(),this.active=!0)},disable:function(){this.active&&(this.removeListener(),this.$previewer.remove(),this.$element.removeClass("previewer-open"),this.$previewer=null,this.$viewport=null,this.active=!1)},addListener:function(){this.$previewer.on("click",a.proxy(this.click,this)),this.$viewport.on("load",this.load)},removeListener:function(){this.$previewer.off("click",this.click),this.$viewport.off("load",this.load)},click:function(a){"previewer-close"===a.target.className&&this.disable()},load:function(){var b,c;try{b=this.contentDocument||this.contentWindow.document,b&&(c=a(b.body).outerHeight()+200)}catch(d){console.log(d.message)}c&&a(this).height(c)},redirect:function(){var a=b.href,c="timestamp="+(new Date).valueOf();a+=-1===a.indexOf("?")?"?"+c:c,this.$viewport.attr("src",a)}},c.template=['<div class="previewer">','<div class="previewer-sidebar">','<button class="previewer-close" title="Close">&times;</button>','<ul class="previewer-nav">','<li title="Phone"><a href="?previewer=phone"><i class="previewer-icon-phone"></i></a></li>','<li title="Tablet"><a href="?previewer=tablet"><i class="previewer-icon-tablet"></i></a></li>','<li title="Laptop"><a href="?previewer=laptop"><i class="previewer-icon-laptop"></i></a></a></li>','<li title="Desktop"><a href="?previewer=desktop"><i class="previewer-icon-desktop"></i></a></a></li>',"</ul>","</div>",'<div class="previewer-mainbody">','<iframe class="previewer-viewport" scrolling="no"></iframe>',"</div>","</div>"].join(""),a.fn.previewer=function(b){this.each(function(){"body"===this.tagName.toLowerCase()&&a(this).data("previewer",new c(this,b))})},a.fn.previewer.Constructor=c,a(function(){a("body").previewer()})});